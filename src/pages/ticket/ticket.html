<template>
  <div class="t-page-ticket">
    <div class="ticket-header">
      <div class="header-left">
        <div class="header">工单</div>
        <div class="sub-header">个人/工单</div>
      </div>
      <div class="header-right">
        <button class="add-ticket" click.trigger="createTicket()">
          <span class="icon-add"></span>创建新工单
        </button>
      </div>
    </div>

    <div class="ticket-body">
      <div class="ticket-container">
        <div class="ticket-search-bar">
          <div class="single-item-filter">
            <label>工单编号</label>
            <input class="form-control" value.bind="query.ticketNo"
                   blur.trigger="cleanQuery('ticketNo', ['startDate', 'endDate', 'keyword'])"/>
          </div>

          <div class="double-item-filter">
            <div class="filter-item">
              <label>从</label>
              <input class="form-control" value.bind="query.startDate"
                     blur.trigger="cleanQuery('startDate', ['ticketNo'])"/>
            </div>

            <div class="filter-item">
              <label>到</label>
              <input class="form-control" value.bind="query.endDate"
                     blur.trigger="cleanQuery('endDate', ['ticketNo'])"/>
            </div>
          </div>

          <div class="single-item-filter">
            <label>关键词</label>
            <input class="form-control" value.bind="query.keyword"
                   blur.trigger="cleanQuery('keyword', ['ticketNo'])"/>
          </div>

          <div class="single-item-filter single-item-filter-sm">
            <button click.trigger="search()">
              <span class="icon-filter"></span>检索
            </button>
          </div>
        </div>

        <table class="table tickets-table">
          <thead>
            <tr>
              <td></td>
              <td>ID</td>
              <td>P</td>
              <td>标题</td>
              <td>队列</td>
              <td>类别</td>
              <td>状态</td>
              <td>创建时间</td>
              <td>截止时间</td>
              <td>创建者</td>
              <td>指派</td>
              <td>操作</td>
            </tr>
          </thead>
          <tbody>
            <tr repeat.for="ticket of tickets" class="${(ticket.selected)?'selected':''}">
              <td><input type="checkbox" checked.bind="ticket.selected"/></td>
              <td>${ticket.id}</td>
              <td>${ticket.p}</td>
              <td class="ticket-title">
                ${(ticket.title && ticket.title.length > 8)?ticket.title.substring(0, 8) + "...":ticket.title}
              </td>
              <td>${ticket.queue}</td>
              <td>${ticket.category}</td>
              <td>
                <span class="icon-circle ${ticket.status.toLowerCase()}"></span>
                ${ticket.status}
              </td>
              <td>${ticket.createDate}</td>
              <td>${ticket.endDate}</td>
              <td>${ticket.creator}</td>
              <td>${ticket.assignee}</td>
              <td>
                <span class="ticket-table-icon icon-cross-flow"></span>
                <span class="ticket-table-icon icon-remove"></span>
                <span class="ticket-table-icon icon-power"></span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</template>